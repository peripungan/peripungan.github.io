const columnOrder=["SKU","Nama","Harga","Total","A12 - 1","A12 - 2","A12 - 3","A12 - 4","A19 - 1","A19 - 2","A19 - 3","A20 - 1","A20 - 2","A20 - 3","A20 - 4","LTC"],lantaiColumns=columnOrder.slice(4);let data=[],tab="all",batchSize=100,renderedRows=0,currentSort={column:null,asc:!0},autoRefreshInterval=null;"serviceWorker"in navigator&&navigator.serviceWorker.register("service-worker.js").then(e=>console.log("✅ Service Worker registered:",e.scope)).catch(e=>console.error("⚠️ Service Worker failed:",e));let clusterize=new Clusterize({rows:[],scrollId:"scrollArea",contentId:"contentArea",no_data_text:"Tidak ada data"});function changeTheme(e){document.body.className=e,localStorage.setItem("selectedTheme",e)}function loadSavedTheme(){let e=localStorage.getItem("selectedTheme");if(e){document.body.className=e;let t=document.getElementById("themeSelector");t&&(t.value=e)}}function formatCurrency(e){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(e)}function onStockToggle(){let e=document.getElementById("stockToggle").checked;tab=e?"minus":"all",renderedRows=0,clusterize.clear(),renderTable(),showToast(e?"❌ Menampilkan Stok Minus":"\uD83D\uDCE6 Menampilkan Semua Data")}function debounce(e,t){let r;return function(...a){clearTimeout(r),r=setTimeout(()=>e.apply(this,a),t)}}function capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}function getSelectedFloors(){return JSON.parse(localStorage.getItem("selectedFloors")||JSON.stringify(lantaiColumns))}function saveSelectedFloors(e){localStorage.setItem("selectedFloors",JSON.stringify(e)),renderedRows=0,document.querySelector("#data-table tbody").innerHTML="",renderTable()}function setupLantaiCheckboxes(){let e=document.getElementById("lantaiFilter");e.innerHTML="",lantaiColumns.forEach(t=>{let r=document.createElement("label"),a=document.createElement("input");a.type="checkbox",a.value=t;let l=getSelectedFloors();a.checked=l.includes(t),a.onchange=()=>{let e=Array.from(document.querySelectorAll("#lantaiFilter input:checked")).map(e=>e.value);saveSelectedFloors(e)},r.appendChild(a),r.append(" ",t),e.appendChild(r)})}function selectAllFloors(){let e=document.querySelectorAll("#lantaiFilter input[type='checkbox']");e.forEach(e=>e.checked=!0);let t=Array.from(e).map(e=>e.value);saveSelectedFloors(t)}function clearAllFloors(){let e=document.querySelectorAll("#lantaiFilter input[type='checkbox']");e.forEach(e=>e.checked=!1),saveSelectedFloors([])}function initResize(e){return function(t){let r=document.querySelectorAll("th")[e],a=t.pageX,l=r.offsetWidth;function n(e){let t=l+(e.pageX-a);r.style.width=t+"px"}function o(){document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",o)}document.addEventListener("mousemove",n),document.addEventListener("mouseup",o)}}function renderTable(){let e=document.getElementById("searchInput").value.toLowerCase().trim(),t=getSelectedFloors(),r=["SKU","Nama","Harga","Total",...t],a=document.querySelector("#data-table thead");a.innerHTML="";let l=document.createElement("tr");r.forEach((e,t)=>{let r=document.createElement("th");r.textContent=e,r.onclick=()=>sortTable(e),currentSort.column===e&&r.classList.add(currentSort.asc?"sort-asc":"sort-desc");let a=document.createElement("div");a.classList.add("resizer"),a.addEventListener("mousedown",initResize(t)),r.appendChild(a),l.appendChild(r)}),a.appendChild(l);let n=data.filter(r=>{let a=`${r.SKU??""} ${r.Nama??""}`.toLowerCase(),l=e.split(/\s+/),n=l.every(e=>a.includes(e)),o="minus"!==tab||t.some(e=>0>Number(r[e]))||0>Number(r.Total);return n&&o}),o=n.slice(0,renderedRows+batchSize),s=buildTableRows(o,r);clusterize.update(s),renderedRows+=batchSize}function sortTable(e){currentSort.asc=currentSort.column!==e||!currentSort.asc,currentSort.column=e,document.querySelectorAll("#data-table thead th").forEach(e=>{e.classList.remove("sort-asc","sort-desc")});let t=document.querySelectorAll("#data-table thead th");t.forEach(t=>{t.textContent.trim()===e&&t.classList.add(currentSort.asc?"sort-asc":"sort-desc")}),data=[...data].sort((t,r)=>{let a=t[e]??"",l=r[e]??"";return currentSort.asc?compareValues(a,l):compareValues(l,a)}),renderedRows=0,clusterize.clear(),renderTable()}function refreshTable(){renderedRows=0,document.querySelector("#data-table tbody").innerHTML="",renderTable()}const debouncedRefreshTable=debounce(refreshTable,250);function onSearchInput(){let e=document.getElementById("searchInput"),t=document.querySelector(".clear-button");""!==e.value.trim()?t.classList.add("show"):t.classList.remove("show"),debouncedRefreshTable()}function clearSearch(){let e=document.getElementById("searchInput");e.value="",onSearchInput()}async function fetchData(){document.getElementById("spinner").style.display="inline-block";let e=await fetch("https://pusatpneumatic.com/pernataan/scripts/stok-dev.json"),t=await e.json();data=(t||[]).map(e=>{let t={SKU:e.s,Nama:e.n,Harga:e.p,Total:e.t};return e.k.forEach(e=>{t[e.l]=e.q}),t}),setupLantaiCheckboxes(),renderedRows=0,clusterize.clear(),renderTable(),document.getElementById("lastUpdated").textContent=new Date().toLocaleTimeString("id-ID"),document.getElementById("spinner").style.display="none"}function buildTableRows(e,t){return e.map(e=>{let r="<tr>";return t.forEach(t=>{let a=e[t],l="",n="";if(void 0===a||""===a)a="-";else if("Harga"===t){let o=Number(a);a=formatCurrency(o),l="harga",n=`data-raw="${o}"`}["SKU","Nama"].includes(t)?l+="left-align":isNaN(a)||(l+="right-align"),r+=`<td class="${l.trim()}" ${n}>${a}</td>`}),r+="</tr>"})}function toggleAutoRefresh(){let e=document.getElementById("autoRefreshToggle"),t=e.checked;t?(showToast("\uD83D\uDD04 Auto Update AKTIF"),autoRefreshInterval=setInterval(()=>{console.log("Auto refreshing..."),fetchData()},6e4)):(showToast("⏸️ Auto Update NONAKTIF"),clearInterval(autoRefreshInterval),autoRefreshInterval=null)}function showToast(e){let t=document.createElement("div");t.textContent=e,t.style.position="fixed",t.style.bottom="20px",t.style.left="50%",t.style.transform="translateX(-50%)",t.style.background="#333",t.style.color="#fff",t.style.padding="8px 16px",t.style.borderRadius="20px",t.style.fontSize="0.85rem",t.style.zIndex="1000",t.style.opacity="0",t.style.transition="opacity 0.3s",document.body.appendChild(t),setTimeout(()=>t.style.opacity="1",10),setTimeout(()=>{t.style.opacity="0",setTimeout(()=>t.remove(),300)},2e3)}function compareValues(e,t){let r=parseFloat(e),a=parseFloat(t);return isNaN(r)||isNaN(a)?String(e).localeCompare(String(t),"id",{numeric:!0}):r-a}window.addEventListener("DOMContentLoaded",()=>{toggleAutoRefresh()}),document.getElementById("scrollArea").addEventListener("scroll",()=>{let e=document.getElementById("scrollArea");e.scrollTop+e.clientHeight>=e.scrollHeight-10&&renderTable()}),document.getElementById("toggleFilterBtn").addEventListener("click",function(){let e=document.querySelector(".filter-wrapper"),t=document.getElementById("toggleFilterBtn"),r=e.classList.toggle("show");t.textContent=(r?"\uD83D\uDD3C":"\uD83D\uDD3D")+" Filter"}),document.addEventListener("mouseover",e=>{if(e.target.matches("td.harga")){let t=e.target,r=parseFloat(t.dataset.raw);isNaN(r)||(t.dataset.original=t.textContent,t.textContent=formatCurrency(1.11*r))}}),document.addEventListener("mouseout",e=>{let t=e.target;e.target.matches("td.harga")&&t.dataset.original&&(t.textContent=t.dataset.original,delete t.dataset.original)}),document.getElementById("lastUpdated").addEventListener("click",function(){let e=document.getElementById("hidup-jokowi");e.currentTime=0,e.play()}),document.addEventListener("DOMContentLoaded",()=>{document.getElementById("stockToggle").checked="minus"===tab;let e=document.getElementById("scrollArea"),t=document.getElementById("rocketmeluncur"),r=!1;e.addEventListener("scroll",()=>{r||(e.scrollTop>200?t.classList.add("showrocket"):t.classList.remove("showrocket"))}),t.addEventListener("click",()=>{t.classList.add("launchrocket");let a=document.getElementById("roket-audio");a.currentTime=0,a.play(),r=!0,e.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>{t.classList.remove("launchrocket"),t.classList.remove("showrocket"),r=!1},800)})}),loadSavedTheme(),fetchData();