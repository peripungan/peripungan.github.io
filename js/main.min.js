const columnOrder=["SKU","NAMA","Harga PL","Grand Total","A12 - 1","A12 - 2","A12 - 3","A12 - 4","A19 - 1","A19 - 2","A19 - 3","A20 - 1","A20 - 3","LTC"],lantaiColumns=columnOrder.slice(4);let data=[],tab="all",batchSize=100,renderedRows=0,currentSort={column:null,asc:!0};function changeTheme(e){document.body.className=e,localStorage.setItem("selectedTheme",e)}function loadSavedTheme(){let e=localStorage.getItem("selectedTheme");if(e){document.body.className=e;let t=document.getElementById("themeSelector");t&&(t.value=e)}}function formatCurrency(e){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(e)}function setTab(e){tab=e,document.getElementById("tabAll").classList.remove("active"),document.getElementById("tabMinus").classList.remove("active"),document.getElementById("tab"+capitalize(e)).classList.add("active"),renderedRows=0,document.querySelector("#data-table tbody").innerHTML="",renderTable()}function debounce(e,t){let r;return function(...n){clearTimeout(r),r=setTimeout(()=>e.apply(this,n),t)}}function capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}function getSelectedFloors(){return JSON.parse(localStorage.getItem("selectedFloors")||JSON.stringify(lantaiColumns))}function saveSelectedFloors(e){localStorage.setItem("selectedFloors",JSON.stringify(e)),renderedRows=0,document.querySelector("#data-table tbody").innerHTML="",renderTable()}function setupLantaiCheckboxes(){let e=document.getElementById("lantaiFilter");e.innerHTML="",lantaiColumns.forEach(t=>{let r=document.createElement("label"),n=document.createElement("input");n.type="checkbox",n.value=t;let l=getSelectedFloors();n.checked=l.includes(t),n.onchange=()=>{let e=Array.from(document.querySelectorAll("#lantaiFilter input:checked")).map(e=>e.value);saveSelectedFloors(e)},r.appendChild(n),r.append(" ",t),e.appendChild(r)})}function selectAllFloors(){let e=document.querySelectorAll("#lantaiFilter input[type='checkbox']");e.forEach(e=>e.checked=!0);let t=Array.from(e).map(e=>e.value);saveSelectedFloors(t)}function clearAllFloors(){let e=document.querySelectorAll("#lantaiFilter input[type='checkbox']");e.forEach(e=>e.checked=!1),saveSelectedFloors([])}function initResize(e){return function(t){let r=document.querySelectorAll("th")[e],n=t.pageX,l=r.offsetWidth;function a(e){let t=l+(e.pageX-n);r.style.width=t+"px"}function o(){document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",o)}document.addEventListener("mousemove",a),document.addEventListener("mouseup",o)}}function renderTable(){let e=document.getElementById("searchInput").value.toLowerCase().trim(),t=getSelectedFloors(),r=["SKU","NAMA","Harga PL","Grand Total",...t],n=document.querySelector("#data-table thead"),l=document.querySelector("#data-table tbody");n.innerHTML="";let a=document.createElement("tr");r.forEach((e,t)=>{let r=document.createElement("th");r.textContent=e,r.onclick=()=>sortTable(e),currentSort.column===e&&r.classList.add(currentSort.asc?"sort-asc":"sort-desc");let n=document.createElement("div");n.classList.add("resizer"),n.addEventListener("mousedown",initResize(t)),r.appendChild(n),a.appendChild(r)}),n.appendChild(a);let o=data.filter(r=>{let n=`${r.SKU??""} ${r.NAMA??""}`.toLowerCase(),l=e.trim().split(/\s+/),a=l.every(e=>n.includes(e)),o="minus"!==tab||t.some(e=>0>Number(r[e]))||0>Number(r["Grand Total"]);return a&&o}),c=document.createDocumentFragment(),s=o.slice(renderedRows,renderedRows+batchSize);s.forEach(e=>{let t=document.createElement("tr");r.forEach(r=>{let n=document.createElement("td"),l=e[r];if(void 0===l||""===l)l="-";else if("Harga PL"===r){let a=Number(l);n.textContent=formatCurrency(a),n.classList.add("harga"),n.addEventListener("mouseover",()=>{n.textContent=formatCurrency(1.11*a)}),n.addEventListener("mouseout",()=>{n.textContent=formatCurrency(a)})}else n.textContent=l;["SKU","NAMA"].includes(r)?n.classList.add("left-align"):isNaN(l)||n.classList.add("right-align"),t.appendChild(n)}),c.appendChild(t)}),l.appendChild(c),renderedRows+=batchSize}function sortTable(e){currentSort.asc=currentSort.column!==e||!currentSort.asc,currentSort.column=e,data.sort((t,r)=>{let n=t[e]??"",l=r[e]??"";return currentSort.asc?n.toString().localeCompare(l.toString(),void 0,{numeric:!0}):l.toString().localeCompare(n.toString(),void 0,{numeric:!0})}),renderedRows=0,document.querySelector("#data-table tbody").innerHTML="",renderTable()}function refreshTable(){renderedRows=0,document.querySelector("#data-table tbody").innerHTML="",renderTable()}"serviceWorker"in navigator&&navigator.serviceWorker.register("service-worker.js").then(e=>console.log("✅ Service Worker registered:",e.scope)).catch(e=>console.error("⚠️ Service Worker failed:",e));const debouncedRefreshTable=debounce(refreshTable,250);function onSearchInput(){let e=document.getElementById("searchInput"),t=document.querySelector(".clear-button");""!==e.value.trim()?t.classList.add("show"):t.classList.remove("show"),debouncedRefreshTable()}function clearSearch(){let e=document.getElementById("searchInput");e.value="",onSearchInput()}async function fetchData(){document.getElementById("spinner").style.display="inline-block";let e=await fetch("https://pusatpneumatic.com/pernataan/scripts/stok.json"),t=await e.json();data=t||[],setupLantaiCheckboxes(),document.querySelector("#data-table thead").innerHTML="",document.querySelector("#data-table tbody").innerHTML="",renderedRows=0,renderTable(),document.getElementById("lastUpdated").textContent=new Date().toLocaleTimeString("id-ID"),document.getElementById("spinner").style.display="none"}document.getElementById("tableWrapper").addEventListener("scroll",()=>{let e=document.getElementById("tableWrapper");e.scrollTop+e.clientHeight>=e.scrollHeight-10&&renderTable()}),document.getElementById("toggleFilterBtn").addEventListener("click",function(){let e=document.querySelector(".filter-wrapper"),t=document.getElementById("toggleFilterBtn"),r=e.classList.toggle("show");t.textContent=(r?"\uD83D\uDD3C":"\uD83D\uDD3D")+" Filter"}),document.getElementById("lastUpdated").addEventListener("click",function(){let e=document.getElementById("easterAudio");e.currentTime=0,e.play()}),document.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("tableWrapper"),t=document.getElementById("rocketmeluncur"),r=!1;e.addEventListener("scroll",()=>{r||(e.scrollTop>200?t.classList.add("showrocket"):t.classList.remove("showrocket"))}),t.addEventListener("click",()=>{t.classList.add("launchrocket"),r=!0,e.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>{t.classList.remove("launchrocket"),t.classList.remove("showrocket"),r=!1},800)})}),loadSavedTheme(),fetchData(),setInterval(fetchData,6e4);